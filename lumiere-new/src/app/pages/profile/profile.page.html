<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="router.navigate(['/home'])">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Mon Profil</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="content-wrapper">
    <!-- Profile Header -->
    <div class="profile-header">
      <div class="profile-avatar">
        <div class="avatar-text">{{ getUserInitials() }}</div>
      </div>
      <h2 class="profile-name" *ngIf="user">{{ user.firstname }} {{ user.lastname }}</h2>
      <p class="profile-email" *ngIf="user">{{ user.email }}</p>
    </div>

    <!-- Segment Tabs -->
    <ion-segment [(ngModel)]="selectedSegment" class="profile-segment">
      <ion-segment-button value="profile">
        <ion-label>Informations</ion-label>
      </ion-segment-button>
      <ion-segment-button value="password">
        <ion-label>Mot de passe</ion-label>
      </ion-segment-button>
    </ion-segment>

    <!-- Profile Information Tab -->
    <div *ngIf="selectedSegment === 'profile'" class="tab-content">
      <form [formGroup]="profileForm" (ngSubmit)="onSubmitProfile()">
        <div class="form-card">
          <div class="form-row">
            <div class="form-group">
              <label for="firstname">Prénom *</label>
              <ion-input id="firstname" formControlName="firstname" placeholder="Votre prénom"
                fill="outline"></ion-input>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="lastname">Nom *</label>
              <ion-input id="lastname" formControlName="lastname" placeholder="Votre nom" fill="outline"></ion-input>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="email">Email *</label>
              <ion-input id="email" formControlName="email" type="email" placeholder="votre@email.com"
                fill="outline"></ion-input>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="telephone">Téléphone</label>
              <ion-input id="telephone" formControlName="telephone" type="tel" placeholder="+33 6 12 34 56 78"
                fill="outline"></ion-input>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="adresse">Adresse</label>
              <ion-input id="adresse" formControlName="adresse" placeholder="Votre adresse" fill="outline"></ion-input>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="ville">Ville</label>
              <ion-input id="ville" formControlName="ville" placeholder="Votre ville" fill="outline"></ion-input>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="codePostal">Code Postal</label>
              <ion-input id="codePostal" formControlName="codePostal" placeholder="75000" fill="outline"></ion-input>
            </div>
          </div>
        </div>

        <div class="action-buttons">
          <ion-button *ngIf="!editMode" expand="block" class="edit-btn" (click)="toggleEditMode()" type="button">
            <ion-icon name="create-outline" slot="start"></ion-icon>
            Modifier
          </ion-button>

          <ng-container *ngIf="editMode">
            <ion-button expand="block" class="cancel-btn" (click)="toggleEditMode()" type="button">
              <ion-icon name="close-outline" slot="start"></ion-icon>
              Annuler
            </ion-button>
            <ion-button expand="block" class="save-btn" type="submit" [disabled]="updating || profileForm.invalid">
              <ion-icon name="checkmark-outline" slot="start"></ion-icon>
              {{ updating ? 'Enregistrement...' : 'Enregistrer' }}
            </ion-button>
          </ng-container>
        </div>
      </form>
    </div>

    <!-- Password Change Tab -->
    <div *ngIf="selectedSegment === 'password'" class="tab-content">
      <form [formGroup]="passwordForm" (ngSubmit)="onSubmitPassword()">
        <div class="form-card">
          <div class="form-row">
            <div class="form-group">
              <label for="currentPassword">Mot de passe actuel *</label>
              <ion-input id="currentPassword" formControlName="currentPassword" type="password" placeholder="••••••••"
                fill="outline"></ion-input>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="newPassword">Nouveau mot de passe *</label>
              <ion-input id="newPassword" formControlName="newPassword" type="password" placeholder="••••••••"
                fill="outline"></ion-input>
              <small class="helper-text">Minimum 6 caractères</small>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="confirmPassword">Confirmer le mot de passe *</label>
              <ion-input id="confirmPassword" formControlName="confirmPassword" type="password" placeholder="••••••••"
                fill="outline"></ion-input>
              <small class="error-text"
                *ngIf="passwordForm.get('confirmPassword')?.hasError('passwordMismatch') && passwordForm.get('confirmPassword')?.touched">
                Les mots de passe ne correspondent pas
              </small>
            </div>
          </div>
        </div>

        <div class="action-buttons">
          <ion-button expand="block" class="save-btn" type="submit" [disabled]="updating || passwordForm.invalid">
            <ion-icon name="key-outline" slot="start"></ion-icon>
            {{ updating ? 'Modification...' : 'Changer le mot de passe' }}
          </ion-button>
        </div>
      </form>
    </div>

    <!-- Logout Button -->
    <div class="logout-section">
      <ion-button expand="block" class="logout-btn" (click)="logout()">
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        Déconnexion
      </ion-button>
    </div>

    <div class="spacer"></div>
  </div>
</ion-content>