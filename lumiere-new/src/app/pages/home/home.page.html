<ion-content [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="refreshData($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- HERO GRADIENT BACKGROUND -->
  <div class="hero-gradient"></div>

  <!-- MODERN HEADER -->
  <div class="modern-toolbar">
    <div class="header-content">
      <div class="logo-section">
        <div class="logo-circle">
          <img src="assets/lum.jpg" alt="Lumi√®re Logo" class="logo-img" />
        </div>
        <div class="brand-info">
          <div class="brand-name">LUMI√àRE</div>
          <div class="brand-tag">Votre partenaire livraison</div>
        </div>
      </div>
      <div class="header-actions">
        <div class="icon-btn" (click)="goToNotifications()">
          <ion-icon name="notifications-outline"></ion-icon>
          <div class="badge" *ngIf="stats.notifications > 0">{{ stats.notifications }}</div>
        </div>
        <div class="icon-btn" (click)="goToProfile()">
          <ion-icon name="person-circle-outline"></ion-icon>
        </div>
        <div class="icon-btn" (click)="logout()">
          <ion-icon name="log-out-outline"></ion-icon>
        </div>
      </div>
    </div>
  </div>

  <!-- HERO SECTION -->
  <div class="hero-section">
    <div class="user-welcome">
      <div class="avatar-container">
        <div class="avatar-glow"></div>
        <div class="avatar">
          <ion-icon name="person"></ion-icon>
        </div>
      </div>
      <div class="welcome-text">
        <p class="greeting">Bonjour üëã</p>
        <h1 class="user-name">{{ getFullName() }}</h1>
        <p class="subtitle">Bienvenue sur votre espace</p>
      </div>
    </div>  ¬≤
  </div>

  <!-- CONTENT WRAPPER -->
  <div class="content-wrapper">

    <!-- STATS SECTION -->
    <div class="stats-section">
      <div class="stat-card card-primary" (click)="navigateTo('/demandes/list')">
        <div class="card-bg"></div>
        <div class="card-content">
          <div class="stat-icon">
            <ion-icon name="hourglass-outline"></ion-icon>
          </div>
          <div class="stat-info">
            <p class="stat-label">En cours</p>
            <h2 class="stat-value">{{ stats.mesDemandesEnCours }}</h2>
          </div>
        </div>
        <div class="card-shine"></div>
      </div>

      <div class="stat-card card-blue" (click)="navigateTo('/livraisons/tracking')">
        <div class="card-bg"></div>
        <div class="card-content">
          <div class="stat-icon">
            <ion-icon name="car-outline"></ion-icon>
          </div>
          <div class="stat-info">
            <p class="stat-label">Livraisons actives</p>
            <h2 class="stat-value">{{ stats.mesLivraisonsEnCours }}</h2>
          </div>
        </div>
        <div class="card-shine"></div>
      </div>

      <div class="stat-card card-green" (click)="navigateTo('/demandes/list')">
        <div class="card-bg"></div>
        <div class="card-content">
          <div class="stat-icon">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
          </div>
          <div class="stat-info">
            <p class="stat-label">Livr√©es</p>
            <h2 class="stat-value">{{ stats.mesDemandesTerminees }}</h2>
          </div>
        </div>
        <div class="card-shine"></div>
      </div>

      <div class="stat-card card-purple" (click)="navigateTo('/demandes/list')">
        <div class="card-bg"></div>
        <div class="card-content">
          <div class="stat-icon">
            <ion-icon name="document-text-outline"></ion-icon>
          </div>
          <div class="stat-info">
            <p class="stat-label">Total commandes</p>
            <h2 class="stat-value">{{ stats.totalMesDemandes }}</h2>
          </div>
        </div>
        <div class="card-shine"></div>
      </div>
    </div>

    <!-- QUICK ACTIONS -->
    <div class="section">
      <div class="section-header">
        <h3>
          <ion-icon name="flash-outline" class="section-icon"></ion-icon>
          Actions rapides
        </h3>
      </div>
      <div class="actions-grid">
        <div class="action-card" *ngFor="let action of quickActions" (click)="navigateTo(action.route)">
          <div class="action-icon" [ngClass]="action.color">
            <ion-icon [name]="action.icon"></ion-icon>
          </div>
          <span class="action-label" [innerHTML]="action.label"></span>
        </div>
      </div>
    </div>

    <!-- MES COMMANDES R√âCENTES -->
    <div class="section" *ngIf="mesDemandesRecentes.length > 0">
      <div class="section-header">
        <h3>
          <ion-icon name="time-outline" class="section-icon"></ion-icon>
          Activit√© r√©cente
        </h3>
        <button class="view-all-btn" (click)="navigateTo('/demandes/list')">
          Tout voir
          <ion-icon name="chevron-forward-outline"></ion-icon>
        </button>
      </div>
      <div class="activity-list">
        <div class="activity-item" *ngFor="let demande of mesDemandesRecentes" (click)="viewDemandeDetails(demande)">
          <div class="activity-indicator" [ngClass]="getStatusClass(demande.statut)"></div>
          <div class="activity-content">
            <div class="activity-header">
              <span class="activity-id">Commande #{{ demande.id }}</span>
              <span class="activity-time">{{ formatTime(demande.dateDemande) }}</span>
            </div>
            <div class="activity-details">
              <p class="activity-date">{{ formatDate(demande.dateDemande) }}</p>
              <span class="activity-status" [ngClass]="getStatusClass(demande.statut)">
                {{ getStatusLabel(demande.statut) }}
              </span>
            </div>
          </div>
          <ion-icon name="chevron-forward-outline" class="activity-arrow"></ion-icon>
        </div>
      </div>
    </div>

    <!-- MES LIVRAISONS ACTIVES -->
    <div class="section" *ngIf="mesLivraisonsActives.length > 0">
      <div class="section-header">
        <h3>
          <ion-icon name="navigate-circle-outline" class="section-icon"></ion-icon>
          Livraisons en cours
        </h3>
      </div>
      <div class="activity-list">
        <div class="activity-item" *ngFor="let livraison of mesLivraisonsActives" (click)="trackLivraison(livraison)">
          <div class="activity-indicator EN_COURS"></div>
          <div class="activity-content">
            <div class="activity-header">
              <span class="activity-id">Livraison #{{ livraison.id }}</span>
              <span class="activity-time">{{ formatTime(livraison.dateDebut) }}</span>
            </div>
            <div class="activity-details">
              <p class="activity-date">{{ livraison.chauffeur?.nom || 'Chauffeur assign√©' }}</p>
              <span class="activity-status EN_COURS">
                {{ getStatusLabel(livraison.statut) }}
              </span>
            </div>
          </div>
          <ion-icon name="chevron-forward-outline" class="activity-arrow"></ion-icon>
        </div>
      </div>
    </div>

    <!-- EMPTY STATE -->
    <div class="section" *ngIf="mesDemandesRecentes.length === 0 && mesLivraisonsActives.length === 0">
      <div class="empty-state">
        <div class="empty-icon">
          <ion-icon name="cart-outline"></ion-icon>
        </div>
        <h3>Aucune commande r√©cente</h3>
        <p>Commencez par cr√©er votre premi√®re demande</p>
        <button class="primary-btn" (click)="createNewDemande()">
          <ion-icon name="add-circle-outline"></ion-icon>
          Nouvelle demande
        </button>
      </div>
    </div>

    <div class="spacer"></div>
  </div>

  <!-- FLOATING ACTION BUTTON -->
  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button class="modern-fab" (click)="createNewDemande()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

</ion-content>